<md-toolbar>
  <img src="../../assets/green-dot.png" class="logo-image">
  <span class="logo">BeatMap</span>
  <img *ngIf="(af.auth | async)?.uid" src="{{ (af.auth | async)?.auth.photoURL }}" class="profile-image" [mdMenuTriggerFor]="menu">
  <md-menu #menu="mdMenu">
    <button md-menu-item (click)="filterByCurrentUser()">My Profile</button>
    <button md-menu-item (click)="logout()">Logout</button>
  </md-menu>
  <button *ngIf="!(af.auth | async)?.uid" md-raised-button (click)="login()" class="login">Login</button>
  <button *ngIf="(af.auth | async)?.uid" md-raised-button (click)="globalService.toggleForm();globalService.playlistKey.next(null)" class="alt">
    <span *ngIf="showForm !== true">Add a Playlist</span>
    <span *ngIf="showForm === true">Hide</span>
  </button>
</md-toolbar>

<md-sidenav
  class="md-sidenav-left"
  md-component-id="left"
  md-disable-backdrop
  md-is-locked-open="true"
  md-is-open="true"
  md-whiteframe="4"
  [ngClass]="{ 'full-height': showReset || searchTerm || showForm }">

  <add-form></add-form>

  <div class="clearfix"></div>

  <div class="search-container">
    <md-input-container class="search-playlists">
      <input mdInput placeholder="Search Playlists" [(ngModel)]="searchTerm">
    </md-input-container>
    <md-icon class="sort" [mdMenuTriggerFor]="sort">sort</md-icon>
    <md-menu #sort="mdMenu">
      <button md-menu-item (click)="changeOrder('-published')">Newest Playlists</button>
      <button md-menu-item (click)="changeOrder('-likesTotal')">Popular Playlists</button>
    </md-menu>
  </div>

  <div class="text-center reset-playlists" *ngIf="showReset || (searchTerm && searchTerm !== '')" (click)="resetPlaylists()" [ngClass]="{ 'visible': showReset || (searchTerm && searchTerm !== '')}">
      View All Playlists
  </div>

  <div class="playlists-container" [ngClass]="{ 'push-down': showReset || searchTerm, 'visible': showReset || searchTerm }">

    <h2 *ngIf="headline" class="headline">
      <md-icon *ngIf="filterKey === 'location'">location_on</md-icon> {{ headline }}
    </h2>
    <h2 *ngIf="filterKey === 'coordinates'" class="headline">
      <md-icon>location_on</md-icon> {{ (filteredPlaylists | async | filter: filterKey : filterValue | first)?.location }}
    </h2>
    <h2 *ngIf="filterKey === 'user' && headline !== 'My Playlists'" class="headline">
      <img src="{{ (users | async | get: ((filteredPlaylists | async | filter: filterKey : filterValue | first)?.user))?.photoURL }}"> {{ (users | async | get: ((filteredPlaylists | async | filter: filterKey : filterValue | first)?.user))?.name }}
    </h2>

    <div *ngIf="!showCurrentUserProfile">
      <md-card *ngFor="let playlist of filteredPlaylists | async | filter: filterKey : filterValue | search: searchTerm | orderBy: [orderValue]" class="playlist-card">
        <playlist-card [playlist]="playlist"></playlist-card>
      </md-card>
    </div>

    <md-tab-group *ngIf="showCurrentUserProfile">
      <md-tab label="My Playlists">
        <div *ngIf="(userPlaylists | async)">
          <md-card *ngFor="let playlist of userPlaylists | async | filter: filterKey : filterValue | search: searchTerm | orderBy: [orderValue]" class="playlist-card">
            <playlist-card [playlist]="playlist.$key"></playlist-card>
          </md-card>
        </div>

        <h5 class="text-center" *ngIf="(!(userPlaylists | async) || (userPlaylists | async)?.length === 0)">
          You haven't created any playlists!
        </h5>
      </md-tab>
      <md-tab label="Liked Playlists">
        <div *ngIf="(userLikedPlaylists | async)">
          <md-card *ngFor="let playlist of userLikedPlaylists | async | filter: filterKey : filterValue | search: searchTerm | orderBy: [orderValue]" class="playlist-card">
            <playlist-card [playlist]="playlist.$key"></playlist-card>
          </md-card>
        </div>
      </md-tab>
    </md-tab-group>

  </div>
</md-sidenav>